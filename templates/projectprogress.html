<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Project Progress</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Favicons -->
    <link href="{{ url_for('static', filename='assets/img/favicon.png') }}" rel="icon">
    <link href="{{ url_for('static', filename='assets/img/apple-touch-icon.png') }}" rel="apple-touch-icon">
  
    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet">
  
    <!-- Vendor CSS Files -->
    <link href="{{ url_for('static', filename='assets/vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='assets/vendor/bootstrap-icons/bootstrap-icons.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='assets/vendor/boxicons/css/boxicons.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='assets/vendor/quill/quill.snow.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='assets/vendor/quill/quill.bubble.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='assets/vendor/remixicon/remixicon.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='assets/vendor/simple-datatables/style.css') }}" rel="stylesheet">
    <!-- Template Main CSS File -->
    <link href="{{ url_for('static', filename='assets/css/style.css') }}" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
        }
        header {
            background-color: #343a40;
            
            text-align: center;
            padding: 1rem 0;
        }
        .container {
            margin-top: 2rem;
            background-color: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    {% include 'header.html' %}
    {% include 'sidebar.html' %}

<main id="main" class="main">
    <div class="pagetitle">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="alert-container">
                    {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %} 
        <h1>Project Process</h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
                <li class="breadcrumb-item active">Project Process</li>
            </ol>
        </nav>
    </div>

<section class="container mt-4">
    <h2>Project Progress Update</h2>
    <form method="POST" action="{{ url_for('process') }}">
        <div class="form-group">
            <label for="projectName">Project Name:</label>
            <select class="form-control" id="projectName" name="projectName" onchange="handleProjectChange(this.value)" required>
                <option value="" selected disabled>Select a project</option>
                {% for project in projects %}
                <option value="{{ project.id }}">{{ project.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="taskName">Task list:</label>
            <select class="form-control" id="taskName" name="taskName" required>
                
            </select>
        </div>
        <div class="form-group">
            <label for="taskProgress">Task Progress:</label>
            <select class="form-control" id="taskProgress" name="taskProgress" >
                <option value="Not Started">Not Started</option>
                <option value="In Progress">In Progress</option>
                <option value="Completed">Completed</option>
            </select>
        </div>

        <button class="btn btn-primary" type="submit">Update Progress</button>
    </form>
</section>



<section class="container mt-4">
    <h2>Project Progress Update</h2>
    <form>
        <div class="form-group">
            <label for="completedTasks">Completed Tasks:</label>
            <div id="completedTasks"></div>

            
        </div>
        
    </form>
</section>

</main>

<script>
    function updateTasks(projectId) {
        var tasksDropdown = document.getElementById('taskName');
        tasksDropdown.innerHTML = '<option value="" selected disabled>Select a task</option>'; // Reset tasks dropdown

        fetch(`/get_tasks_by_project/${projectId}`)
            .then(response => response.json())
            .then(data => {
                data.tasks.forEach(task => {
                    var option = new Option(task.name, task.id);
                    tasksDropdown.add(option);
                });
            });}
    function updateTaskList(projectId) {
        console.log("updateTaskList called with projectId:", projectId);
        if (projectId) {
        const url = `/get_completed_tasks/${projectId}`;
        fetch(url)
            .then(response => response.json())
            .then(data => {
                const completedTasksList = document.getElementById('completedTasks');
                completedTasksList.innerHTML = ''; 

                if (data.tasks && data.tasks.length > 0) {
                    data.tasks.forEach(task => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${task.name} - Due: ${task.due_date}`;
                        completedTasksList.appendChild(listItem);
                    });
                } else {
                    completedTasksList.innerHTML = '<li>No completed tasks.</li>';
                }
            })
            .catch(error => {
                console.error('Error fetching completed tasks:', error);
            });
    } else {
        document.getElementById('completedTasks').innerHTML = '<li>No completed tasks.</li>';
    }
}
    function handleProjectChange(projectId) {
    updateTasks(projectId);
    updateTaskList(projectId);
}
</script>

{% include 'js.html' %}
</body>
</html>